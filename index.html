<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BICI PLANNER PRO XL</title>
    <style>
        :root { 
            --p: #2563eb; 
            /* Paleta solicitada */
            --danger: #003366; /* Azul Oscuro (Peligro) */
            --warn: #ffcc00;   /* Amarillo (Precauci√≥n) */
            --safe: #009e73;   /* Verde (D√≠a perfecto) */
            --bg: #000; 
        }
        
        body { background: #1a1a1a; margin: 0; padding: 0; display: flex; justify-content: center; color: #fff; font-family: ui-sans-serif, system-ui, sans-serif; }
        .phone-container { width: 100%; max-width: 430px; background: var(--bg); min-height: 100vh; display: flex; flex-direction: column; }
        
        .search-box { background: #111; padding: 15px; border-bottom: 1px solid #222; display: flex; gap: 8px; }
        .search-input { background: #222; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; flex-grow: 1; outline: none; font-size: 1rem; }
        .search-btn { background: var(--p); border: none; color: #fff; padding: 10px 18px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        
        .tabs { display: flex; background: #111; border-bottom: 1px solid #222; position: sticky; top: 0; z-index: 10; }
        .tab { flex: 1; padding: 18px; text-align: center; font-size: 0.9rem; font-weight: 900; color: #555; cursor: pointer; text-transform: uppercase; }
        .tab.active { color: var(--p); border-bottom: 4px solid var(--p); background: #18181b; }

        .card { 
            display: flex; 
            align-items: center; 
            padding: 15px 12px; 
            border-bottom: 0.5px solid rgba(255, 255, 255, 0.1); 
            border-left: 10px solid #333; 
            height: 90px;
            box-sizing: border-box;
        }
        
        .time-label { min-width: 65px; font-weight: 800; font-size: 1.1rem; color: #aaa; }
        .temp-main { min-width: 100px; text-align: center; display: flex; flex-direction: column; }
        .temp-val { font-size: 2.4rem; font-weight: 950; display: block; line-height: 0.85; }
        .temp-range { font-size: 1.1rem; font-weight: 800; display: flex; justify-content: center; gap: 6px; margin-top: 5px; }
        .t-max { color: #ff6b6b; }
        .t-min { color: #4dadff; }
        .temp-sub { font-size: 0.75rem; color: #666; font-weight: 800; text-transform: uppercase; }
        
        .icon { flex-grow: 1; text-align: center; font-size: 2.5rem; }
        .stats { text-align: right; min-width: 110px; }
        .val { font-size: 1.7rem; font-weight: 900; display: inline-block; line-height: 1; }
        .label { font-size: 0.7rem; color: #666; font-weight: 900; text-transform: uppercase; margin-right: 4px; }

        .risk-danger { border-left-color: var(--danger); } 
        .risk-warn { border-left-color: var(--warn); }   
        .risk-safe { border-left-color: var(--safe); }                        

        #loader { text-align: center; padding: 40px; color: #444; font-weight: bold; display: none; }
    </style>
</head>
<body onload="init()">

<div class="phone-container">
    <div class="search-box">
        <input type="text" id="loc-input" class="search-input" placeholder="Ciudad..." value="Alcorc√≥n">
        <button onclick="handleSearch()" class="search-btn">IR</button>
    </div>

    <div class="tabs">
        <div class="tab active" id="tab-hourly" onclick="switchTab('hourly')">24 HORAS</div>
        <div class="tab" id="tab-daily" onclick="switchTab('daily')">15 D√çAS</div>
    </div>

    <div id="loader">CARGANDO...</div>
    <div id="view-container"></div>
</div>

<script>
let currentLat = 40.3366, currentLon = -3.8369;
let weatherData = null;
let currentMode = 'hourly';

const icons = { 0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 48: "üå´Ô∏è", 51: "üå¶Ô∏è", 53: "üå¶Ô∏è", 55: "üå¶Ô∏è", 61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è", 71: "‚ùÑÔ∏è", 80: "üåßÔ∏è", 81: "üåßÔ∏è", 82: "üåßÔ∏è", 95: "‚õàÔ∏è" };

async function init() { await fetchData(); }

async function handleSearch() {
    const q = document.getElementById('loc-input').value;
    if (!q) return;
    document.getElementById('loader').style.display = 'block';
    const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1`);
    const data = await res.json();
    if (data.length > 0) {
        currentLat = data[0].lat; currentLon = data[0].lon;
        await fetchData();
    }
}

async function fetchData() {
    document.getElementById('loader').style.display = 'block';
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${currentLat}&longitude=${currentLon}&hourly=temperature_2m,apparent_temperature,precipitation_probability,wind_gusts_10m,weather_code&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max,wind_gusts_10m_max,weather_code&timezone=auto&forecast_days=16`;
    const res = await fetch(url);
    weatherData = await res.json();
    document.getElementById('loader').style.display = 'none';
    render();
}

function switchTab(mode) {
    currentMode = mode;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(`tab-${mode}`).classList.add('active');
    render();
}

function getRiskInfo(gusts, rainProb) {
    // Peligro: Viento > 25 o Lluvia > 30%
    if (gusts > 25 || rainProb > 30) return { class: 'risk-danger', color: 'var(--danger)' };
    // Precauci√≥n: Viento entre 16-25 o Lluvia entre 1-30%
    if (gusts > 15 || rainProb > 0) return { class: 'risk-warn', color: 'var(--warn)' };
    // D√≠a perfecto: Viento <= 15 y 0% Lluvia
    return { class: 'risk-safe', color: 'var(--safe)' };
}

function render() {
    if(!weatherData) return;
    const container = document.getElementById('view-container');
    container.innerHTML = '';
    
    if(currentMode === 'hourly') {
        const h = weatherData.hourly;
        const now = new Date();
        const currentHourStr = now.toISOString().split('T')[0] + "T" + now.getHours().toString().padStart(2, '0') + ":00";
        let startIndex = h.time.findIndex(t => t.startsWith(currentHourStr));
        if (startIndex === -1) startIndex = 0;

        for(let i = startIndex; i < startIndex + 24; i++) {
            const gusts = Math.round(h.wind_gusts_10m[i]);
            const rain = h.precipitation_probability[i];
            const risk = getRiskInfo(gusts, rain);
            
            container.innerHTML += `
                <div class="card ${risk.class}">
                    <div class="time-label">${h.time[i].split('T')[1]}</div>
                    <div class="temp-main">
                        <span class="temp-val">${Math.round(h.temperature_2m[i])}¬∞</span>
                        <span class="temp-sub">SENS. ${Math.round(h.apparent_temperature[i])}¬∞</span>
                    </div>
                    <div class="icon">${icons[h.weather_code[i]] || "üå§Ô∏è"}</div>
                    <div class="stats">
                        <div><span class="label">VIENTO</span><span class="val" style="color:${risk.color}">${gusts}</span></div>
                        <div><span class="label">LLUVIA</span><span class="val" style="color:${rain > 0 ? '#4dadff' : '#444'}">${rain}%</span></div>
                    </div>
                </div>`;
        }
    } else {
        const d = weatherData.daily;
        for(let i=0; i<15; i++) {
            const dateObj = new Date(d.time[i]);
            const gusts = Math.round(d.wind_gusts_10m_max[i]);
            const rain = d.precipitation_probability_max[i];
            const risk = getRiskInfo(gusts, rain);

            container.innerHTML += `
                <div class="card ${risk.class}">
                    <div class="time-label">
                        <span style="text-transform: capitalize; color: var(--p)">${dateObj.toLocaleDateString('es-ES', {weekday: 'short'})}</span><br>
                        <span style="font-size: 1.1rem; color:#666">${dateObj.getDate()}</span>
                    </div>
                    <div class="temp-main">
                        <div class="temp-range">
                            <span class="t-max">${Math.round(d.temperature_2m_max[i])}¬∞</span>
                            <span class="t-min">${Math.round(d.temperature_2m_min[i])}¬∞</span>
                        </div>
                        <span class="temp-sub">MAX / MIN</span>
                    </div>
                    <div class="icon">${icons[d.weather_code[i]] || "üå§Ô∏è"}</div>
                    <div class="stats">
                        <div><span class="label">VIENTO</span><span class="val" style="color:${risk.color}">${gusts}</span></div>
                        <div><span class="label">LLUVIA</span><span class="val" style="color:${rain > 0 ? '#4dadff' : '#444'}">${rain}%</span></div>
                    </div>
                </div>`;
        }
    }
}
</script>
</body>
</html>