<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PREVISI√ìN BICI PRO</title>
    <style>
        :root { 
            --low: #e0f2fe; --med: #7dd3fc; --high: #0369a1;   
            --cold: #38bdf8; --hot: #fb923c; --danger: #ef4444; 
            --bg: #000;
        }
        
        * { box-sizing: border-box; font-family: 'Arial Black', sans-serif; } 
        body { background: #1a1a1a; margin: 0; display: flex; justify-content: center; min-height: 100vh; color: white; }
        
        .phone-container { width: 100%; max-width: 450px; background: var(--bg); display: flex; flex-direction: column; }

        .search-container {
            padding: 10px; background: #222; display: flex; gap: 5px;
            border-bottom: 1px solid #444; position: sticky; top: 0; z-index: 101;
        }
        #search-input {
            flex-grow: 1; padding: 12px; border-radius: 10px; border: 2px solid #444;
            background: #000; color: white; font-size: 1rem;
        }
        #search-input.error { border-color: var(--danger); }
        .search-btn {
            padding: 10px 15px; background: var(--high); border: none; 
            border-radius: 10px; color: white; font-weight: bold; cursor: pointer;
        }

        .header-title { 
            background: #111; color: #888; text-align: center; 
            padding: 8px; font-size: 0.9rem; text-transform: uppercase;
        }

        #section-24h, #section-15d { padding: 5px; flex-grow: 1; margin-bottom: 80px; }
        #section-15d { display: none; }

        .card { 
            border-radius: 18px; padding: 4px; margin-bottom: 6px;
            display: grid; gap: 4px; border: 3px solid transparent; height: 110px;
            grid-template-columns: 90px 1fr 1fr 1fr;
        }

        .risk-low { background: var(--low); border-color: var(--low); }
        .risk-med { background: var(--med); border-color: var(--med); }
        .risk-high { background: var(--high); border-color: var(--high); }

        .sub-box { 
            border-radius: 12px; display: flex; flex-direction: column; 
            align-items: center; color: white; background: var(--bg); 
            padding: 4px 2px; overflow: hidden; justify-content: space-between;
        }

        .label { align-self: stretch; text-align: center; font-size: 0.55rem; text-transform: uppercase; opacity: 0.8; }
        .time-tag-big { font-size: 1.1rem; margin-top: 2px; text-transform: uppercase; }
        .weather-icon-big { font-size: 3.3rem; line-height: 0.7; margin: auto 0; }

        .c-cold { color: var(--cold); } .c-hot { color: var(--hot); } .c-danger { color: var(--danger); }

        .val-big { font-size: 2.5rem; font-weight: 900; line-height: 0.75; letter-spacing: -1.5px; margin: auto 0; } 
        .val-small { font-size: 1rem; font-weight: bold; margin-bottom: 2px; }

        .nav-bar { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 2px; 
            background: #222; padding: 10px; position: fixed; bottom: 0; width: 100%; max-width: 450px;
        }
        .nav-btn { 
            background: #333; color: #888; border: none; padding: 16px; 
            border-radius: 12px; font-size: 1.1rem; font-weight: 900;
        }
        .nav-btn.active { background: #444; color: #fff; }
    </style>
</head>
<body onload="init()">

<div class="phone-container">
    <div class="search-container">
        <input type="text" id="search-input" placeholder="Buscar ciudad...">
        <button class="search-btn" onclick="searchCity()">OK</button>
    </div>
    <div class="header-title" id="location-name">Cargando...</div>
    
    <div id="section-24h"></div>
    <div id="section-15d"></div>

    <nav class="nav-bar">
        <button id="btn-24h" class="nav-btn active" onclick="showSection('24h')">24H</button>
        <button id="btn-15d" class="nav-btn" onclick="showSection('15d')">15 D√çAS</button>
    </nav>
</div>

<script>
let currentLat = 40.4167, currentLon = -3.7033; 
const weatherIcons = { 0: "‚òÄÔ∏è", 1: "üå§Ô∏è", 2: "‚õÖ", 3: "‚òÅÔ∏è", 45: "üå´Ô∏è", 48: "üå´Ô∏è", 51: "üå¶Ô∏è", 53: "üå¶Ô∏è", 55: "üå¶Ô∏è", 61: "üåßÔ∏è", 63: "üåßÔ∏è", 65: "üåßÔ∏è", 66: "üßä", 67: "üßä", 71: "‚ùÑÔ∏è", 73: "‚ùÑÔ∏è", 75: "‚ùÑÔ∏è", 80: "üå¶Ô∏è", 81: "üå¶Ô∏è", 82: "üå¶Ô∏è", 95: "‚õàÔ∏è", 96: "‚õàÔ∏è", 99: "‚õàÔ∏è" };

async function searchCity() {
    const input = document.getElementById('search-input');
    const query = input.value.trim();
    if (!query) return;
    try {
        const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${query}&count=1&language=es&format=json`);
        const data = await res.json();
        if (data.results && data.results.length > 0) {
            const city = data.results[0];
            input.classList.remove('error');
            currentLat = city.latitude; currentLon = city.longitude;
            document.getElementById('location-name').innerText = `${city.name}, ${city.admin1 || city.country}`;
            fetchWeather();
        } else { input.classList.add('error'); }
    } catch (e) { console.error(e); }
}

async function fetchWeather() {
    try {
        const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${currentLat}&longitude=${currentLon}&hourly=temperature_2m,apparent_temperature,precipitation,precipitation_probability,wind_speed_10m,wind_gusts_10m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max,precipitation_sum,wind_speed_10m_max,wind_gusts_10m_max&timezone=auto&forecast_days=16`);
        const data = await res.json();
        render24h(data.hourly);
        render15d(data.daily);
    } catch (e) { console.error(e); }
}

function createCard(title, iconCode, t1, t2, p1, p2, w1, w2) {
    const risk = (p1 > 40 || p2 > 0.5 || w1 > 30) ? 'risk-high' : (p1 > 15 || w1 > 18) ? 'risk-med' : 'risk-low';
    
    // L√≥gica para ocultar ceros
    const displayP1 = p1 > 0 ? p1 + '%' : '';
    const displayP2 = p2 > 0 ? p2.toFixed(1) + 'm' : '';
    const displayW1 = w1 > 0 ? w1 : '';
    const displayW2 = w2 > 0 ? '(' + w2 + ')' : '';

    return `
    <div class="card ${risk}">
        <div class="sub-box"><div class="time-tag-big">${title}</div><div class="weather-icon-big">${weatherIcons[iconCode] || "üå§Ô∏è"}</div></div>
        <div class="sub-box"><span class="label">TEMP</span><span class="val-big ${t1<12?'c-cold':t1>27?'c-danger':''}">${t1}¬∞</span><span class="val-small">${t2}¬∞</span></div>
        <div class="sub-box"><span class="label">LLUVIA</span><span class="val-big ${p1>20?'c-danger':''}">${displayP1}</span><span class="val-small">${displayP2}</span></div>
        <div class="sub-box"><span class="label">VIENTO</span><span class="val-big ${w1>25?'c-danger':''}">${displayW1}</span><span class="val-small">${displayW2}</span></div>
    </div>`;
}

function render24h(h) {
    const list = document.getElementById('section-24h');
    const nowIdx = new Date().getHours();
    let html = '';
    for (let i = 0; i < 24; i++) {
        const idx = nowIdx + i;
        if (!h.time[idx]) break;
        const d = new Date(h.time[idx]);
        html += createCard(`${d.getHours()}:00`, h.weather_code[idx], Math.round(h.temperature_2m[idx]), Math.round(h.apparent_temperature[idx]), h.precipitation_probability[idx], h.precipitation[idx], Math.round(h.wind_speed_10m[idx]), Math.round(h.wind_gusts_10m[idx]));
    }
    list.innerHTML = html;
}

function render15d(d) {
    const list = document.getElementById('section-15d');
    let html = '';
    for (let i = 0; i < 15; i++) {
        const date = new Date(d.time[i]);
        const day = date.toLocaleDateString('es-ES', {weekday: 'short'}).replace('.','');
        html += createCard(day, d.weather_code[i], Math.round(d.temperature_2m_max[i]), Math.round(d.temperature_2m_min[i]), d.precipitation_probability_max[i], d.precipitation_sum[i], Math.round(d.wind_speed_10m_max[i]), Math.round(d.wind_gusts_10m_max[i]));
    }
    list.innerHTML = html;
}

function showSection(s) {
    document.getElementById('section-24h').style.display = (s === '24h' ? 'block' : 'none');
    document.getElementById('section-15d').style.display = (s === '15d' ? 'block' : 'none');
    document.getElementById('btn-24h').className = `nav-btn ${s === '24h' ? 'active' : ''}`;
    document.getElementById('btn-15d').className = `nav-btn ${s === '15d' ? 'active' : ''}`;
}

function init() { 
    document.getElementById('location-name').innerText = "Madrid, Espa√±a";
    fetchWeather(); 
}
</script>
</body>
</html>